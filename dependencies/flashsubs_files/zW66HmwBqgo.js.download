if (self.CavalryLogger) { CavalryLogger.start_js(["BTjmp"]); }

__d('MessengerMessageGroup.react',['cx','fbt','invariant','BootloadOnRender.react','immutable','ImmutableObject','Image.react','JSResource','LazyComponent.react','Link.react','MercuryConfig','MercuryIDs','MercuryParticipants','MercuryParticipantSilhouettes','MessengerActions','messengerContactActionsRe','MessengerMessage.react','MessengerPageAdminNoteList.react','messengerProfileImageWrapperReact','MessengerStickerUtils','MessengerTextWithEmoticons.react','messengerURIUtilsRe','PagesMessengerCreatorInfo.react','React','ReactDOM','SimpleXUIDialog','StoreAndPropBasedStateMixin'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k=c('messengerContactActionsRe').actions,l=c('messengerProfileImageWrapperReact').jsComponent,m=c('immutable').List,n=c('immutable').OrderedMap,o=c('React').PropTypes,p=32,q=new (c('ImmutableObject'))({image_src:c('MercuryParticipantSilhouettes').neutralSilhouette,is_messenger_user:true,name:''}),r=c('React').createClass({displayName:'MessengerMessageGroup',mixins:[c('StoreAndPropBasedStateMixin')(c('MercuryParticipants'))],propTypes:{activeMessageID:o.string,deliveryTimestamp:o.number.isRequired,hasDateBreak:o.bool,isCanonical:o.bool,isFromViewer:o.bool,isPageMessage:o.bool,lastReadTimestamp:o.number.isRequired,messages:o.instanceOf(m).isRequired,nextTimestamp:o.number.isRequired,onAttachmentLoad:o.func,onMessageDeselect:o.func.isRequired,onMessageSelect:o.func.isRequired,readReceipts:o.instanceOf(n).isRequired,thread:o.object,pageCustomAction:o.func,pageID:o.string},statics:{calculateState:function u(v){return {participants:s(v)};}},shouldComponentUpdate:function u(v,w){return this.props.activeMessageID!==v.activeMessageID||this.props.isFromViewer!==v.isFromViewer||this.props.deliveryTimestamp!==v.deliveryTimestamp||this.props.lastReadTimestamp!==v.lastReadTimestamp||!c('immutable').is(this.props.messages,v.messages)||!c('immutable').is(this.props.readReceipts,v.readReceipts)||!c('immutable').is(this.state.participants,w.participants)||!!(v.thread&&this.props.thread&&this.props.thread!==v.thread);},render:function u(){return c('React').createElement('div',null,c('React').createElement('div',{className:"_1t_p"+(' '+"clearfix")+(c('MessengerStickerUtils').isStickerMessageGroup(this.props.messages)?' '+"_5tx1":'')+(this._hasSeenHeadsAtBottom()?' '+"_35fy":'')},this._renderProfileColumn(),c('React').createElement('div',{className:"_41ud"},this._renderName(),this._renderMessages())),this.props.isPageMessage?this._renderNotes():null);},_renderProfileColumn:function u(){if(this.props.isFromViewer)return null;var v=this.props.messages.last(),w=this.state.participants.get(v.author)||q,x=i._("{name}",[i.param('name',w.name)]),y=c('React').createElement(l,{className:"_1t_r",isMessengerUser:w.is_messenger_user,size:p,showBadge:true,tooltipContent:x},c('React').createElement(c('Image.react'),{alt:w.name,src:w.image_src,height:p,width:p}));if(w.fbid){var z=c('messengerURIUtilsRe').getURIForUserID(w.fbid);if(c('MercuryConfig').WWWMessengerAvatarActions){y=c('React').createElement(c('BootloadOnRender.react'),{loader:c('JSResource')('MessengerAvatarActions.react').__setRef('MessengerMessageGroup.react'),placeholder:!this.props.isCanonical?c('React').createElement(c('Link.react'),{className:"_5f0v",href:z.toString(),onClick:this._handleContactSelect.bind(this,w),tabIndex:-1},y):y,component:c('React').createElement(c('LazyComponent.react'),{avatar:y,contact:w,showSendMessageItem:!this.props.isCanonical,onAction:this._handleContactAction})});}else if(!this.props.isCanonical)y=c('React').createElement(c('Link.react'),{className:"_5f0v",href:z.toString(),onClick:this._handleContactSelect.bind(this,w),tabIndex:-1},y);}return c('React').createElement('div',{className:"_1t_q"},y);},_handleContactAction:function u(v,w,x){switch(v){case k.MESSAGE:this._handleContactSelect(w,x);break;case k.PROFILE:var y=this.state.participants.get(w.id);if(y&&y.href){window.open(y.href);}else this._handleContactSelect(w,x);break;case k.FREE_CALL:e(['FBRTCCore','MNRTCCallabilityStore'],function(z,aa){var ba=w.fbid;ba||j(0);if(z.isAvailableForWebrtcCalling(ba)||aa.isCallable(ba)){z.startOutgoingCall(ba,'messenger_dot_com',false);}else c('SimpleXUIDialog').show(i._("{firstname} can't be reached at the moment.",[i.param('firstname',w.short_name)]),i._("Can't Connect Call"));});break;}},_renderMessages:function u(){var v=this.props.messages.size,w=[];this.props.messages.forEach(function(x,y,z){var aa=x.message_id===this.props.activeMessageID,ba=this.props.isPageMessage&&this.props.pageCustomAction?this.props.pageCustomAction:null;if(ba)w.push(c('React').createElement('h4',{key:'page_action'+x.message_id},c('React').createElement(ba,{message:x})));var ca=c('MercuryIDs').getUserIDFromParticipantID(this.props.author),da=this.props.thread?this.props.thread.custom_color:'';w.push(c('React').createElement(c('MessengerMessage.react'),{customColor:da,deliveryTimestamp:this.props.deliveryTimestamp,isActive:aa,isFromViewer:this.props.isFromViewer,isPageMessage:this.props.isPageMessage,key:x.message_id,message:x,messageActionsWrapper:this.props.messageActionWrapper,onAttachmentLoad:this.props.onAttachmentLoad,participants:this.state.participants,nextTimestamp:this._getNextTimestamp(z,v,y),onDeselect:this.props.onMessageDeselect,onSelect:this.props.onMessageSelect,readReceipts:this.props.readReceipts,showDeliveryState:x.timestamp>this.props.lastReadTimestamp,ref:x.message_id,authorFBID:ca==null?undefined:ca,threadCustomColor:da,pageID:this.props.pageID}));if(t(this.props.isPageMessage,z,y,x))w.push(c('React').createElement(c('PagesMessengerCreatorInfo.react'),{key:'creator_info:'+y,creator_info:x.creator_info}));}.bind(this));return w;},_renderNotes:function u(){var v=[];this.props.messages.forEach(function(w,x,y){if(this.props.isPageMessage&&w.page_admin_notes)v.push(c('React').createElement(c('MessengerPageAdminNoteList.react'),{key:'notes:'+w.message_id,notes:w.page_admin_notes}));}.bind(this));return v;},_renderName:function u(){var v=this.state.participants.get(this.props.messages.first().author);if(!v)return null;var w=v.short_name;if(this.props.thread){var x=this.props.thread.custom_nickname?this.props.thread.custom_nickname:null,y=c('MercuryIDs').getUserIDFromParticipantID(v.id);if(x&&y&&x[y])w=c('React').createElement(c('MessengerTextWithEmoticons.react'),{renderEmoticons:true,renderEmoji:true,text:x[y]});}return c('React').createElement('h5',{className:"_ih3"+(this.props.isFromViewer?' '+"accessible_elem":'')+(this.props.isCanonical?' '+"_-ne":'')},w);},getMessageElement:function u(v){return c('ReactDOM').findDOMNode(this.refs[v]);},_hasSeenHeadsAtBottom:function u(){var v=this.props,w=v.messages,x=v.nextTimestamp,y=v.readReceipts,z=w.last().timestamp,aa=0;y.forEach(function(ba){if(ba>=z&&ba<x)if(++aa===2)return false;});return aa===2;},_getNextTimestamp:function u(v,w,x){return x<w-1?v.get(x+1).timestamp:this.props.nextTimestamp;},_handleContactSelect:function u(v,w){w&&w.preventDefault();var x=c('MercuryIDs').getThreadIDFromParticipantID(v.id);x&&c('MessengerActions').selectThread(x);}});function s(u){var v=u.messages.first().author;return c('immutable').Map().withMutations(function(w){u.readReceipts.forEach(function(x,y){w.set(y,c('MercuryParticipants').getOrFetch(y));});w.set(v,c('MercuryParticipants').getOrFetch(v));});}function t(u,v,w,x){if(!u||!x.creator_info)return false;if(w===v.size-1)return true;var y=v.get(w+1).creator_info;if(!y)return true;return x.creator_info.creatorID!==y.creatorID;}f.exports=r;}),null);