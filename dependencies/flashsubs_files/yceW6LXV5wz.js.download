if (self.CavalryLogger) { CavalryLogger.start_js(["8dEhl"]); }

__d('MessengerAttachmentRenderer',['cx','EmojiSticker.react','MercuryAttachment','MercuryAttachmentType','MercuryAudioType','MercuryIDs','MercuryShareAttachment.react','MercuryShareAttachmentRenderLocations','MessagingFlowerBorder.react','MessagingFlowerBorderChecker','MessagingGiftWrap.react','MessagingGiftWrapChecker','MessengerErrorAttachment.react','MessengerFileAttachment.react','MessengerFromViewerUtils','MessengerHotLikePreview.react','MessengerHotLikeUtils','MessengerPhotosGroup.react','MessengerStickerUtils','MessengerSupportedEmojiUtils','MessengerVoiceClipAttachment.react','MessengerWebDriverTestIDs','React','Sticker.react','StickerAssetType','StickerConstants','StickerInterfaces','StickerUtils','StickersActions','StickersPackInTray','StickersStoreController','StoryAttachmentStyle','XStickerAssetController','idx','isRetina','wrapNullableForReact'],(function a(b,c,d,e,f,g,h){'use strict';var i=700,j='sticker:',k='giftwrap:',l='share:',m="_1c_u",n=function p(q){return q===Object(q);},o={getAttachmentsInsideBubble:function p(q,r){var s=c('MercuryAttachment').get(q).filter(n).filter(function(t){return !this.attachmentShouldAppearOutsideBubble(t);}.bind(this));return this._getAttachmentComponents(s,q,r);},getAttachmentsOutsideBubble:function p(q,r,s,t){var u=c('MercuryAttachment').get(q).filter(n).filter(function(v){return this.attachmentShouldAppearOutsideBubble(v);}.bind(this));return this._getAttachmentComponents(u,q,r,s,t);},_getAttachmentComponents:function p(q,r,s,t,u){var v=this._getPhotosGroup(q.filter(c('MercuryAttachment').isPhotoGroupAttachment),r,s,t),w=q.filter(function(x){return !c('MercuryAttachment').isPhotoGroupAttachment(x);}).map(function(x){return this._getAttachmentComponent(x,r,s,t,u);}.bind(this));if(v)w.push(v);return w;},_getAttachmentComponent:function p(q,r,s,t,u){var v=t&&t.customColor,w=t&&t.onUnwrap,x=t&&t.isVisible,y=t&&t.onSelect;if(c('MessengerStickerUtils').isStickerAttachment(q))return this._getStickerComponent(q,r,v,w);if(this.isEmojiLikeAttachment(q))return this._getEmojiLikeAttachment(q,r,w);if(this.isVoiceClip(q))return this._getVoiceClip(q,r,v,w);if(this.isFileAttchment(q))return this._getFileComponent(q,r);if(this.isP2P(q)||this.isShareAttachment(q))return this._getShareAttachment(q,r,s,x,y,u);if(this.isErrorAttachment(q))return this._getErrorAttachment(q,r);return null;},_getStickerComponent:function p(q,r,s,t){if(r.is_like_preview)return this._maybeGiftWrapSticker(c('React').createElement(c('MessengerHotLikePreview.react'),{customColor:s,customLike:r.customLike,key:'hlp:'+r.like_preview_since,since:r.like_preview_since}),r,t);var u=q.metadata;if(!u){u=c('MessengerHotLikeUtils').getMetadataForHotLike(r.sticker_id);if(!u){u={};var v=c('StickerUtils').getScaledDimensions(c('StickerConstants').THREAD_SIZE,c('StickerConstants').THREAD_SIZE,c('StickerConstants').THREAD_SIZE),w=v.height,x=v.width;u.height=w;u.width=x;}u.stickerID=r.sticker_id;}var y=c('XStickerAssetController').getURIBuilder().setInt('sticker_id',u.stickerID),z=null,aa=null;if(c('isRetina')()){z=u.paddedSpriteURI2x;aa=u.spriteURI2x;}else{z=u.paddedSpriteURI;aa=u.spriteURI;}var ba=u.stickerID.toString(),ca=c('React').createElement(c('Sticker.react'),{accessibilityLabel:u.accessibilityLabel,className:"_2poz"+(' '+"_ui9")+(c('MessagingGiftWrapChecker').shouldRenderWithGiftWrap(r)&&!!c('MessengerHotLikeUtils').getMetadataForHotLike(ba)?' '+"_4ue_":''),animationTrigger:'hover',customColor:s,frameCount:u.frameCount||1,frameRate:u.frameRate||c('StickerConstants').DEFAULT_FRAME_RATE,framesPerCol:u.framesPerCol||1,framesPerRow:u.framesPerRow||1,key:j+r.message_id,onStickerClick:function da(ea,fa){c('StickersPackInTray').onIsPackInTray(ea,c('StickerInterfaces').MESSAGES,function(ga){if(ga.in_sticker_tray){c('StickersActions').selectTrayPack(ea);c('StickersActions').showStickerFlyout(r.thread_id);}else c('StickersStoreController').showStore(ea);});},packID:u.packID&&u.packID.toString(),paddedSpriteURI:z,sourceHeight:u.height,sourceURI:y.setEnum('image_type',c('StickerAssetType').IMAGE).getURI().toString(),sourceWidth:u.width,spriteURI:aa,stickerID:ba,testID:c('MessengerWebDriverTestIDs').STICKER});return this._maybeGiftWrapSticker(ca,r,t);},_getEmojiLikeAttachment:function p(q,r,s){var t=c('MessengerSupportedEmojiUtils').transferSize(q.size),u=c('MessengerSupportedEmojiUtils').getNewEmojiData(r.body,t),v=u?u.emoji:undefined;if(!u)return this._getErrorAttachment(q,r);var w=c('React').createElement(c('EmojiSticker.react'),{className:"_2poz _ui9",key:j+r.message_id,emoji:r.body,emojiImage:v,sourceURI:''});return this._maybeGiftWrapSticker(w,r,s);},_getShareAttachment:function p(q,r,s,t,u,v){var w,x,y=null;if(r&&r.platform_xmd)y=JSON.parse(r.platform_xmd);var z=(w=q)!=null?(w=w.share)!=null?(w=w.messenger_ctas)!=null?(w=w[0])!=null?w.page_id:w:w:w:w,aa=(x=q)!=null?(x=x.share)!=null?(x=x.target)!=null?(x=x.items)!=null?(x=x[0])!=null?(x=x.call_to_actions)!=null?(x=x[0])!=null?x.page_id:x:x:x:x:x:x:x,ba=z||aa,ca=ba?c('MercuryIDs').getParticipantIDFromUserID(ba):r.author;return c('React').createElement(c('MercuryShareAttachment.react'),{attachment:q.share,isSponsored:r.is_sponsored,isVisible:!!t,key:l+r.message_id,location:c('MercuryShareAttachmentRenderLocations').MESSENGER,maxWidth:i,messageID:r.message_id,mnMessageType:y&&y.template_type,onComponentLoaded:s,onSelect:u,pageID:ca,threadID:r.thread_id,afterDecorators:v});},_getVoiceClip:function p(q,r,s,t){s=c('MessengerFromViewerUtils').isFromViewer(r)?s||undefined:undefined;return c('React').createElement(c('MessengerVoiceClipAttachment.react'),{attachment:q,customColor:s,isGiftWrapped:c('MessagingGiftWrapChecker').shouldRenderWithGiftWrap(r),hasFlowerBorder:c('MessagingFlowerBorderChecker').shouldRenderWithFlowerBorder(r),key:'audio:'+r.message_id,message:r,onUnwrap:function(u){function v(){return u.apply(this,arguments);}v.toString=function(){return u.toString();};return v;}(function(){t&&t();})});},_getErrorAttachment:function p(q,r){return c('React').createElement(c('MessengerErrorAttachment.react'),{attachment:q,key:'error:'+r.message_id});},_getPhotosGroup:function p(q,r,s,t){if(!q.length)return null;var u=t&&t.onUnwrap,v=t&&t.isVisible,w=t&&t.onSelect,x=t&&t.isPageMessage,y=t&&t.pageID,z=c('MessagingFlowerBorderChecker').shouldRenderWithFlowerBorder(r),aa=c('MessagingGiftWrapChecker').shouldRenderWithGiftWrap(r)&&this._rendersWithoutAttribution(q);return c('React').createElement(c('MessengerPhotosGroup.react'),{attachments:q,className:"_2poz _52mr _ui9",count:q.length,hasFlowerBorder:z,isGiftWrapped:aa,isPageMessage:x,isVisible:!!v,key:'photos:'+r.message_id,message:r,onSelect:w,onUnwrap:function(ba){function ca(){return ba.apply(this,arguments);}ca.toString=function(){return ba.toString();};return ca;}(function(){u&&u();}),pageID:y});},getVideoElem:function p(q,r){var s=r.getMessageElement(q);if(!s)return null;var t=s.getElementsByClassName(m);return t&&t.length?t[0]:s;},_rendersWithoutAttribution:function p(q){return q.length!=1||!c('MercuryAttachment').hasAttribution(q[0]);},_getFileComponent:function p(q,r){return c('React').createElement(c('MessengerFileAttachment.react'),{attachment:q,className:"_2poz",key:'file:'+q.url});},attachmentShouldAppearOutsideBubble:function p(q){return c('MessengerStickerUtils').isStickerAttachment(q)||c('MercuryAttachment').isPhotoGroupAttachment(q)||this.isShareAttachment(q)||this.isP2P(q)||this.isVoiceClip(q)||this.isErrorAttachment(q)||this.isEmojiLikeAttachment(q);},isPhotosGroupAttachment:function p(q){var r=q.props.attachments;return !!r&&r.length>1&&r.some(function(s){return !!s&&c('MercuryAttachment').isPhotoGroupAttachment(s);});},isRenderedShareAttachment:function p(q){return !!(q.key&&q.key.startsWith(l));},isFileAttchment:function p(q){return q.attach_type===c('MercuryAttachmentType').FILE;},isShareAttachment:function p(q){return !!(this._isStoryBased(q)&&!this.isP2P(q)&&(q.share.style_list.indexOf(c('StoryAttachmentStyle').SHARE)>-1||q.share.style_list.indexOf(c('StoryAttachmentStyle').FALLBACK)>-1));},isSharedVideoAttachment:function p(q){var r=q.attach_type===c('MercuryAttachmentType').SHARE&&q.share&&q.share.subattachments&&q.share.subattachments[0];return !!(r&&r.target&&r.target.video_id);},isP2P:function p(q){return !!(this._isStoryBased(q)&&q.share.style_list.indexOf(c('StoryAttachmentStyle').ORION)>-1);},_isStoryBased:function p(q){return !!(q.attach_type===c('MercuryAttachmentType').SHARE&&q.share&&q.share.style_list);},isEmojiLikeAttachment:function p(q){return q.attach_type===c('MercuryAttachmentType').EMOJI_LIKE;},isVoiceClip:function p(q){return !!q.metadata&&(q.metadata.type===c('MercuryAudioType').AudioClip||q.metadata.type===c('MercuryAudioType').VoiceMessageWithTranscript);},isVoiceClipAttachment:function p(q){var r=c('MercuryAttachment').get(q).filter(n).filter(function(s){return this.isVoiceClip(s);}.bind(this));return !!r.length;},isP2PAttachment:function p(q){var r=c('MercuryAttachment').get(q).filter(function(s){return n(s)&&this.isP2P(s);}.bind(this));return !!r.length;},isSingleVideoAttachment:function p(q){var r=c('MercuryAttachment').get(q).filter(n).filter(function(s){return c('MercuryAttachment').isVideoAttachment(s);});return r.length===1;},isSharedVideoAttachmentMessage:function p(q){var r=c('MercuryAttachment').get(q).filter(n).filter(function(s){return this.isSharedVideoAttachment(s)||this.isGenieSharedVideoAttachment(s);}.bind(this));return r.length===1;},isGenieSharedVideoAttachment:function p(q){return !!(q.attach_type===c('MercuryAttachmentType').SHARE&&q.share&&q.share.style_list.indexOf(c('StoryAttachmentStyle').GENIE_MESSAGE)>-1&&q.share.target&&q.share.target.attachment&&this.isSharedVideoAttachment(q.share.target.attachment));},isErrorAttachment:function p(q){return q.attach_type===c('MercuryAttachmentType').ERROR;},_maybeGiftWrapComponentForMessage:function p(q,r,s){var t=c('MessagingGiftWrapChecker').shouldRenderWithGiftWrap(r),u=c('MessagingFlowerBorderChecker').shouldRenderWithFlowerBorder(r);if(!t&&!u)return q;return c('React').createElement('div',{key:k+r.message_id},q,t?c('React').createElement(c('MessagingGiftWrap.react'),{onUnwrap:c('wrapNullableForReact')(s)}):null,u?c('React').createElement(c('MessagingFlowerBorder.react'),{offset:-10}):null);},_maybeGiftWrapSticker:function p(q,r,s){var t=c('MessagingGiftWrapChecker').shouldRenderWithGiftWrap(r),u=c('MessagingFlowerBorderChecker').shouldRenderWithFlowerBorder(r);if(!t&&!u)return q;return c('React').createElement('div',{key:k+r.message_id},q,t?c('React').createElement(c('MessagingGiftWrap.react'),{isSticker:true,onUnwrap:c('wrapNullableForReact')(s)}):null,u?c('React').createElement(c('MessagingFlowerBorder.react'),{offset:-10}):null);}};f.exports=o;}),null);