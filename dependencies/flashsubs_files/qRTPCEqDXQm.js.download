if (self.CavalryLogger) { CavalryLogger.start_js(["KAYfD"]); }

__d('mercuryRogerRe',['bs_array','Arbiter','utilsRe','bs_caml_obj','JSLogger','immutable','bs_js_boolean','CurrentUser','bs_js_primitive','MercuryThreads','MercuryDispatcher','MercuryActionStatus'],(function a(b,c,d,e,f,g){'use strict';var h={};function i(q,r,s,t){var u=+(r>=q.timestamp),v=q.status,w=1-t||c('bs_caml_obj').caml_notequal(s,q.author);if(u!==0){if(c('bs_js_primitive').is_nil_undef(v)){if(w!==0){return 1;}else return 0;}else if(w!==0&&c('bs_caml_obj').caml_equal(v,c('MercuryActionStatus').SUCCESS)){return 1;}else return 0;}else return 0;}function j(q,r,s){if(c('bs_js_primitive').is_nil_undef(r)){return [];}else{var t=q[0][r.thread_id];if(t!==undefined){return t.reduce(function(u,v,w,x){if(i(r,v.watermark,w,c('utilsRe').isTruthy(s))){return c('bs_array').append(u,[w]);}else return u;},[]);}else return [];}}function k(q,r){var s=q[0][r.thread_id];if(s!==undefined){return c('bs_js_boolean').to_js_boolean(s.reduce(function(t,u,v,w){if(t){return i(r,u.watermark,v,0);}else return 0;},1));}else return false;}function l(q,r){var s=q[0][r];if(s!==undefined){return s;}else return c('immutable').OrderedMap();}function m(q,r,s){var t=q[0][r];if(t!==undefined){var u=t.get(s);if(u!==undefined){return u;}else return null;}else return null;}function n(q){var r=h[q];if(r!==undefined){return r;}else{var s=[{}],t=new (c('Arbiter'))(),u={__fbid:q,getSeenBy:function y(z,aa){return j(s,z,aa);},wasSeenByAll:function y(z){return k(s,z);},getSeenTimestamp:function y(z,aa){return m(s,z,aa);},getSeenTimestamps:function y(z){return l(s,z);},subscribe:function y(z,aa){return t.subscribe(z,aa);},mockInform:function y(z,aa){t.inform(z,aa);return 0;}};h[q]=u;var v=[[]],w=c('MercuryDispatcher').getForFBID(q),x=c('MercuryThreads').getForFBID(q);w.subscribe("update-roger",function(y,z){if(c('bs_js_primitive').is_nil_undef(z)){return 0;}else{Object.keys(z).forEach(function(aa){var ba=x.getThreadMetaNow(aa);Object.keys(z[aa]).forEach(function(da){var ea=s[0][aa],fa=ea!==undefined?ea:c('immutable').OrderedMap(),ga=c('bs_js_primitive').is_nil_undef(ba)?0:[ba.participants],ha=0;if(ga){if(ga[0].indexOf(da)===-1){v[0].push(fa);return 0;}else ha=1;}else ha=1;if(ha===1){var ia=fa.get(da),ja=z[aa][da],ka=0;if(ia!==undefined){if(ja.watermark<=ia.watermark){return 0;}else ka=2;}else ka=2;if(ka===2){s[0][aa]=fa.set(da,ja);return 0;}}});var ca=s[0][aa];if(ca!==undefined){s[0][aa]=ca.sort(function(da,ea){return da.watermark-ea.watermark|0;});return 0;}else return 0;});t.inform("change",z);return 0;}});w.subscribe("invalidate-global-state",function(y,z){s[0]={};v[0]=[];return 0;});c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(y,z){z.read_receipts={valid_receipts:s[0],bad_receipts:v[0]};return 0;});return u;}}function o(){return n(c('CurrentUser').getID());}var p=c('utilsRe').$pipe$unknown;g.$pipe$unknown=p;g.rogersPerFBID=h;g._wasSeen=i;g.getSeenBy=j;g.wasSeenByAll=k;g.getSeenTimestamps=l;g.getSeenTimestamp=m;g.getForFBID=n;g.get=o;}),null);